create table "avalanche" (
    "create_time" timestamp not null,
    "update_time" timestamp not null,
    "external_id" text primary key,
    "viewable" boolean not null,
    "submitter_email" text not null,
    "submitter_experience" text not null,
    "location" text not null,
    "area_name" text not null,
    "date" date not null,
    "scene" text not null,
    "slope" text not null,
    "classification" text not null,
    "human_numbers" text not null,
    "mode_of_travel" text not null,
    "perimeter" text not null,
    "comments" text
  );

create table "avalanche_image" (
    "create_time" timestamp not null,
    "avalanche_external_id" text not null,
    "filename" text not null,
    "original_filename" text not null,
    "mime_type" text not null,
    "size" integer not null,
    primary key(avalanche_external_id, filename)
);
create index "idx76e30961" on "avalanche_image" ("avalanche_external_id");

create table "app_user" (
    "create_time" timestamp not null,
    "email" text primary key
);

create table "app_role" (
    "name" text primary key
);

create table "app_user_role_assignment" (
    "app_user" text not null,
    "app_role" text not null,
    primary key(app_user, app_role)
);

-- foreign key constraints :
alter table "avalanche" add constraint "avalancheFK1" foreign key ("submitter_email") references "app_user"("email");
alter table "app_user_role_assignment" add constraint "app_user_role_assignmentFK2" foreign key ("app_user") references "app_user"("email");
alter table "app_user_role_assignment" add constraint "app_user_role_assignmentFK3" foreign key ("app_role") references "app_role"("name");

-- initial inserts :
insert into app_user (create_time, email) values (now(), 'jamie.sampey@gmail.com');
insert into app_user (create_time, email) values (now(), 'avyeyes@gmail.com');
insert into app_role (name) values ('site_owner');
insert into app_role (name) values ('admin');
insert into app_user_role_assignment(app_user, app_role) values ('jamie.sampey@gmail.com', 'site_owner');
insert into app_user_role_assignment(app_user, app_role) values ('avyeyes@gmail.com', 'admin');
