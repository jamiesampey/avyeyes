create table "avalanche" (
    "create_time" timestamp not null,
    "update_time" timestamp not null,
    "external_id" varchar(8) primary key,
    "viewable" boolean not null,
    "submitter_email" varchar(128) not null,
    "submitter_experience" integer not null,
    "longitude" double precision not null,
    "latitude" double precision not null,
    "area_name" varchar(128) not null,
    "date" date not null,
    "sky" integer not null,
    "precip" integer not null,
    "elevation" double not null,
    "aspect" integer not null,
    "angle" integer not null,    
    "avalanche_type" integer not null,
    "avalanche_trigger" integer not null,
    "avalanche_interface" integer not null,
    "r_size" double precision not null,
    "d_size" double precision not null,
    "human_numbers" varchar(50) not null,
    "mode_of_travel" integer not null,
    "comments" text,
    "perimeter" text not null
  );

create table "avalanche_image" (
    "create_time" timestamp not null,
    "avalanche_external_id" varchar(8) not null,
    "filename" varchar(128) not null,
    "original_filename" varchar(128) not null,
    "mime_type" varchar(20) not null,
    "size" integer not null,
    primary key(avalanche_external_id, filename)
);
-- indexes on avalanche_image
create index "idx76e30961" on "avalanche_image" ("avalanche_external_id");

create table "app_user" (
    "create_time" timestamp not null,
    "email" varchar(128) primary key
);

create table "app_role" (
    "name" varchar(128) primary key
);

create table "app_user_role_assignment" (
    "app_user" varchar(128) not null,
    "app_role" varchar(128) not null,
    primary key(app_user, app_role)
);

-- foreign key constraints :
alter table "avalanche" add constraint "avalancheFK1" foreign key ("submitter_email") references "app_user"("email");
alter table "app_user_role_assignment" add constraint "app_user_role_assignmentFK2" foreign key ("app_user") references "app_user"("email");
alter table "app_user_role_assignment" add constraint "app_user_role_assignmentFK3" foreign key ("app_role") references "app_role"("name");

-- initial inserts :
insert into app_user (create_time, email) values (now(), 'jamie.sampey@gmail.com');
insert into app_user (create_time, email) values (now(), 'avyeyes@gmail.com');
insert into app_role (name) values ('site_owner');
insert into app_role (name) values ('admin');
insert into app_user_role_assignment(app_user, app_role) values ('jamie.sampey@gmail.com', 'site_owner');
insert into app_user_role_assignment(app_user, app_role) values ('avyeyes@gmail.com', 'admin');
